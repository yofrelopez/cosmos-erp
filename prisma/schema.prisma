generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model company {
  id                   Int                    @id @default(autoincrement())
  name                 String
  ruc                  String                 @unique
  logoUrl              String?
  address              String?
  phone                String?
  whatsapp             String?
  facebookUrl          String?
  instagramUrl         String?
  tiktokUrl            String?
  email                String?
  website              String?
  slogan               String?
  description          String?
  notes                String?
  legalRepresentative  String?
  administrator        String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  status               CompanyStatus          @default(ACTIVE)
  bankAccounts         BankAccount[]
  Branch               Branch[]
  clients              Client[]
  contracts            Contract[]
  quotes               Quote[]
  users                user[]
  wallets              Wallet[]
  MoldingColors        MoldingColors[]
  MoldingTextures      MoldingTextures[]
  PricingAccessory     PricingAccessory[]
  PricingBacking       PricingBacking[]
  pricing_frame_preset pricing_frame_preset[]
  PricingGlass         PricingGlass[]
  PricingMatboard      PricingMatboard[]
  PricingMolding       PricingMolding[]
  PricingThickness     PricingThickness[]

  @@map("Company")
}

model user {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  name      String?
  createdAt DateTime  @default(now())
  companyId Int
  isActive  Boolean   @default(true)
  lastLogin DateTime?
  password  String
  phone     String?
  role      UserRole  @default(STAFF)
  updatedAt DateTime  @updatedAt
  username  String    @unique
  quotes    Quote[]
  company   company   @relation(fields: [companyId], references: [id])

  @@map("User")
}

model colors {
  id           Int            @id @default(autoincrement())
  name         String         @unique
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  PricingGlass PricingGlass[]
}

model textures {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Client {
  id             Int          @id @default(autoincrement())
  documentNumber String       @unique
  fullName       String
  businessName   String?
  phone          String?
  email          String?
  address        String?
  notes          String?
  createdAt      DateTime     @default(now())
  companyId      Int
  contactPerson  String?
  documentType   DocumentType
  company        company      @relation(fields: [companyId], references: [id])
  contracts      Contract[]
  quotes         Quote[]
}

model Quote {
  id           Int           @id @default(autoincrement())
  clientId     Int
  status       QuoteStatus
  notes        String?
  total        Float         @default(0)
  createdById  Int?
  createdAt    DateTime      @default(now())
  code         String        @unique
  companyId    Int
  contract     Contract?
  observations Observation[]
  client       Client        @relation(fields: [clientId], references: [id])
  company      company       @relation(fields: [companyId], references: [id])
  createdBy    user?         @relation(fields: [createdById], references: [id])
  items        QuoteItem[]
}

model QuoteItem {
  id          Int              @id @default(autoincrement())
  quoteId     Int
  description String
  unit        String
  quantity    Float
  unitPrice   Float
  subtotal    Float
  quote       Quote            @relation(fields: [quoteId], references: [id])
  images      QuoteItemImage[]
}

model QuoteItemImage {
  id          Int       @id @default(autoincrement())
  quoteItemId Int
  imageUrl    String
  fileName    String
  fileSize    Int?
  mimeType    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  quoteItem   QuoteItem @relation(fields: [quoteItemId], references: [id], onDelete: Cascade)

  @@index([quoteItemId])
}

model Observation {
  id      Int      @id @default(autoincrement())
  quoteId Int
  date    DateTime @default(now())
  type    String
  message String
  quote   Quote    @relation(fields: [quoteId], references: [id])
}

model BankAccount {
  id          Int      @id @default(autoincrement())
  bank        String
  accountType String
  alias       String?
  number      String
  cci         String?
  currency    Currency
  companyId   Int
  company     company  @relation(fields: [companyId], references: [id])
}

model Wallet {
  id        Int        @id @default(autoincrement())
  type      WalletType
  phone     String
  qrUrl     String?
  companyId Int
  company   company    @relation(fields: [companyId], references: [id])
}

model Contract {
  id             Int            @id @default(autoincrement())
  quoteId        Int            @unique
  date           DateTime       @default(now())
  paymentStatus  PaymentStatus
  amountPaid     Float          @default(0)
  amountPending  Float          @default(0)
  deliveryDate   DateTime?
  deliveredAt    DateTime?
  deliveryStatus DeliveryStatus
  notes          String?
  clientId       Int
  companyId      Int
  contractNote   String?
  code           String         @unique
  client         Client         @relation(fields: [clientId], references: [id])
  company        company        @relation(fields: [companyId], references: [id])
  quote          Quote          @relation(fields: [quoteId], references: [id])
  items          ContractItem[]
  payments       Payment[]
}

model ContractItem {
  id          Int                 @id @default(autoincrement())
  contractId  Int
  description String
  unit        String
  quantity    Float
  unitPrice   Float
  subtotal    Float
  contract    Contract            @relation(fields: [contractId], references: [id])
  images      ContractItemImage[]
}

model ContractItemImage {
  id             Int          @id @default(autoincrement())
  contractItemId Int
  imageUrl       String
  fileName       String
  fileSize       Int?
  mimeType       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  contractItem   ContractItem @relation(fields: [contractItemId], references: [id], onDelete: Cascade)

  @@index([contractItemId])
}

model Payment {
  id         Int           @id @default(autoincrement())
  contractId Int
  date       DateTime      @default(now())
  amount     Float
  reference  String?
  notes      String?
  method     PaymentMethod
  contract   Contract      @relation(fields: [contractId], references: [id])
}

model Branch {
  id        Int          @id @default(autoincrement())
  name      String
  address   String
  phone     String?
  status    BranchStatus @default(ACTIVE)
  companyId Int
  Company   company      @relation(fields: [companyId], references: [id])
}

model MoldingColors {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  companyId Int
  Company   company  @relation(fields: [companyId], references: [id])

  @@unique([companyId, name])
  @@map("molding_colors")
}

model MoldingTextures {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  companyId Int
  Company   company  @relation(fields: [companyId], references: [id])

  @@unique([companyId, name])
  @@map("molding_textures")
}

model PricingAccessory {
  id        Int       @id @default(autoincrement())
  companyId Int
  name      String
  price     Decimal   @db.Decimal(12, 2)
  validFrom DateTime  @default(now())
  validTo   DateTime?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  Company   company   @relation(fields: [companyId], references: [id])

  @@unique([companyId, name, validFrom])
  @@index([companyId, name])
  @@index([isActive])
  @@index([validFrom])
  @@index([validTo])
  @@map("pricing_accessory")
}

model PricingBacking {
  id          Int       @id @default(autoincrement())
  companyId   Int
  name        String
  pricePerFt2 Decimal   @db.Decimal(12, 2)
  validFrom   DateTime  @default(now())
  validTo     DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Company     company   @relation(fields: [companyId], references: [id])

  @@unique([companyId, name, validFrom])
  @@index([companyId, name])
  @@index([isActive])
  @@index([validFrom])
  @@index([validTo])
  @@map("pricing_backing")
}

model pricing_frame_preset {
  id        Int              @id @default(autoincrement())
  companyId Int
  name      String
  kind      PricingFrameKind
  recipe    Json
  isActive  Boolean          @default(true)
  validFrom DateTime         @default(now())
  validTo   DateTime?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  Company   company          @relation(fields: [companyId], references: [id])

  @@unique([companyId, name, validFrom])
  @@index([companyId, kind, isActive])
  @@index([validFrom])
  @@index([validTo])
}

model PricingGlass {
  id             Int            @id @default(autoincrement())
  companyId      Int
  commercialName String
  family         GlassFamily
  thicknessMM    Decimal        @db.Decimal(5, 2)
  price          Decimal        @db.Decimal(12, 2)
  validFrom      DateTime       @default(now())
  validTo        DateTime?
  isActive       Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  colorId        Int?
  colorType      GlassColorType @default(INCOLORO)
  oldColor       String?
  colors         colors?        @relation(fields: [colorId], references: [id])
  Company        company        @relation(fields: [companyId], references: [id])

  @@unique([companyId, commercialName, family, thicknessMM, validFrom])
  @@index([colorType])
  @@index([companyId, commercialName])
  @@index([companyId, family])
  @@index([isActive])
  @@index([validFrom])
  @@index([validTo])
  @@map("pricing_glass")
}

model PricingMatboard {
  id          Int       @id @default(autoincrement())
  companyId   Int
  name        String
  pricePerFt2 Decimal   @db.Decimal(12, 2)
  validFrom   DateTime  @default(now())
  validTo     DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Company     company   @relation(fields: [companyId], references: [id])

  @@unique([companyId, name, validFrom])
  @@index([companyId, name])
  @@index([isActive])
  @@index([validFrom])
  @@index([validTo])
  @@map("pricing_matboard")
}

model PricingMolding {
  id                Int                   @id @default(autoincrement())
  companyId         Int
  name              String
  quality           PricingMoldingQuality
  pricePerM         Decimal               @db.Decimal(12, 2)
  validFrom         DateTime              @default(now())
  validTo           DateTime?
  isActive          Boolean               @default(true)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  thicknessId       Int
  Company           company          @relation(fields: [companyId], references: [id])
  thickness         PricingThickness @relation(fields: [thicknessId], references: [id])

  @@unique([companyId, name, thicknessId, validFrom])
  @@index([companyId, name, quality, thicknessId])
  @@index([isActive])
  @@index([validFrom])
  @@index([validTo])
  @@map("pricing_molding")
}

model PricingThickness {
  id       Int              @id @default(autoincrement())
  name     String           @unique
  companyId Int
  moldings PricingMolding[]
  Company  company          @relation(fields: [companyId], references: [id])

  @@map("pricing_thickness")

  @@unique([companyId, name])
}

enum QuoteStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
}

enum DeliveryStatus {
  PENDING
  PARTIAL
  DELIVERED
}

enum CompanyStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum BranchStatus {
  ACTIVE
  INACTIVE
  CLOSED
}

enum WalletType {
  YAPE
  PLIN
}

enum DocumentType {
  DNI
  RUC
  CE
  PASSPORT
}

enum Currency {
  PEN
  USD
  EUR
}

enum PaymentMethod {
  CASH
  TRANSFER
  CARD
  YAPE
  PLIN
  OTHER
}

enum UserRole {
  ADMIN
  OWNER
  STAFF
}

enum GlassFamily {
  PLANO
  CATEDRAL
  TEMPLADO
  ESPEJO
}

enum GlassColorType {
  INCOLORO
  COLOR
  POLARIZADO
  REFLEJANTE
}

enum GlassTexture {
  LISO
  CUADRICULADO
  LLOVIZNA
  GARATACHI
  FLORA
  MARIHUANA
  RAMAS
}

enum PricingMoldingQuality {
  SIMPLE
  FINA
  BASTIDOR
}

enum PricingFrameKind {
  SIN_FONDO
  CON_FONDO
  FONDO_TRANSPARENTE
  CON_BASTIDOR
  ESPECIAL
}
